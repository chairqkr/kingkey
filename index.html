<script>
  // 전역 변수: 페이지5의 날짜만 저장할 변수
  let selectedDateResponse = "";

  document.addEventListener("DOMContentLoaded", function() {
    console.log("✅ JavaScript 로드 완료!");

    function nextPage(currentId, nextId) {
      console.log(`📌 페이지 이동: ${currentId} → ${nextId}`);
      document.getElementById(currentId).classList.add('hidden');
      document.getElementById(nextId).classList.remove('hidden');

      // page5에 도달하면 캘린더 생성
      if (nextId === "page5") {
        console.log("✅ 캘린더 생성 시작");
        setTimeout(generateCalendar, 500);
      }
    }

    // 최종 응답(이름과 날짜)을 Google Sheet에 전송하는 함수
    function sendCombinedResponse() {
      const name = document.getElementById('name').value || "박예슬";
      const scriptURL = "https://script.google.com/macros/s/AKfycbzgGPPtOAKN4JAn48KPgb8fuNyZEXxzksLtcbLrHKtBqQFJibzrRC5ezazj9zVmFqVv2g/exec";
      // URL에 파라미터로 name, 페이지5의 응답(선택 날짜)만 추가
      const url = `${scriptURL}?name=${encodeURIComponent(name)}&responseDate=${encodeURIComponent(selectedDateResponse)}`;
      console.log("📌 전송 URL:", url);

      fetch(url)
        .then(response => response.text())
        .then(data => {
          console.log("✅ 응답 저장 완료:", data);
          nextPage("page5", "page6");
        })
        .catch(error => {
          console.error("❌ 에러 발생:", error);
        });
    }

    // 캘린더 생성 함수 (페이지5)
    function generateCalendar() {
      const calendarElement = document.getElementById('calendar');
      calendarElement.innerHTML = '';
      const availableDates = [7, 8, 10, 11, 18, 24];
      let dayCounter = 2;

      for (let i = 0; i < 28; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.classList.add('calendar-day');
        dayDiv.innerText = dayCounter;

        if (!availableDates.includes(dayCounter)) {
          dayDiv.classList.add('disabled');
        } else {
          dayDiv.onclick = function() {
            selectDate(dayCounter, dayDiv);
          };
        }

        calendarElement.appendChild(dayDiv);
        dayCounter++;
      }
      console.log("✅ 캘린더 생성 완료");
    }

    // 날짜 선택 함수
    function selectDate(day, element) {
      document.querySelectorAll('.calendar-day').forEach(div => div.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('selectedDate').value = day;
    }

    // 페이지 이벤트 리스너

    // 페이지 1 → 페이지 2
    document.getElementById("next1").addEventListener("click", function() {
      nextPage("page1", "page2");
    });

    // 페이지 2 → 페이지 3
    document.getElementById("next2").addEventListener("click", function() {
      nextPage("page2", "page3");
    });

    // 페이지 3: "예" 또는 "아니오" 버튼 클릭 시 (이 부분은 저장하지 않음)
    document.getElementById("yes").addEventListener("click", function() {
      console.log("🔹 페이지3 응답: 예");
      nextPage("page3", "page4");
    });
    document.getElementById("no").addEventListener("click", function() {
      console.log("🔹 페이지3 응답: 아니오");
      nextPage("page3", "page4");
    });

    // 페이지 4 → 페이지 5 (여기서는 별도의 응답 저장 없이 단순 페이지 이동)
    document.getElementById("agree").addEventListener("click", function() {
      console.log("✅ '응' 버튼 눌림 → page5로 이동");
      nextPage("page4", "page5");
    });
    document.getElementById("disagree").addEventListener("click", function() {
      console.log("✅ '아니' 버튼 눌림 → page5로 이동");
      nextPage("page4", "page5");
    });

    // 페이지 5: 캘린더에서 날짜 선택 후 "제출" 버튼 클릭 시
    document.getElementById("submitDate").addEventListener("click", function() {
      const selectedDate = document.getElementById('selectedDate').value;
      if (!selectedDate) {
        alert("날짜를 선택해주세요!");
        return;
      }
      selectedDateResponse = selectedDate;
      console.log("🔹 페이지5 응답 (선택 날짜):", selectedDateResponse);
      // 이름과 날짜만 전송
      sendCombinedResponse();
    });

  });
</script>
