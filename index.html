<script>
  // ì „ì—­ ë³€ìˆ˜: í˜ì´ì§€5ì˜ ë‚ ì§œë§Œ ì €ì¥í•  ë³€ìˆ˜
  let selectedDateResponse = "";

  document.addEventListener("DOMContentLoaded", function() {
    console.log("âœ… JavaScript ë¡œë“œ ì™„ë£Œ!");

    function nextPage(currentId, nextId) {
      console.log(`ğŸ“Œ í˜ì´ì§€ ì´ë™: ${currentId} â†’ ${nextId}`);
      document.getElementById(currentId).classList.add('hidden');
      document.getElementById(nextId).classList.remove('hidden');

      // page5ì— ë„ë‹¬í•˜ë©´ ìº˜ë¦°ë” ìƒì„±
      if (nextId === "page5") {
        console.log("âœ… ìº˜ë¦°ë” ìƒì„± ì‹œì‘");
        setTimeout(generateCalendar, 500);
      }
    }

    // ìµœì¢… ì‘ë‹µ(ì´ë¦„ê³¼ ë‚ ì§œ)ì„ Google Sheetì— ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
    function sendCombinedResponse() {
      const name = document.getElementById('name').value || "ë°•ì˜ˆìŠ¬";
      const scriptURL = "https://script.google.com/macros/s/AKfycbzgGPPtOAKN4JAn48KPgb8fuNyZEXxzksLtcbLrHKtBqQFJibzrRC5ezazj9zVmFqVv2g/exec";
      // URLì— íŒŒë¼ë¯¸í„°ë¡œ name, í˜ì´ì§€5ì˜ ì‘ë‹µ(ì„ íƒ ë‚ ì§œ)ë§Œ ì¶”ê°€
      const url = `${scriptURL}?name=${encodeURIComponent(name)}&responseDate=${encodeURIComponent(selectedDateResponse)}`;
      console.log("ğŸ“Œ ì „ì†¡ URL:", url);

      fetch(url)
        .then(response => response.text())
        .then(data => {
          console.log("âœ… ì‘ë‹µ ì €ì¥ ì™„ë£Œ:", data);
          nextPage("page5", "page6");
        })
        .catch(error => {
          console.error("âŒ ì—ëŸ¬ ë°œìƒ:", error);
        });
    }

    // ìº˜ë¦°ë” ìƒì„± í•¨ìˆ˜ (í˜ì´ì§€5)
    function generateCalendar() {
      const calendarElement = document.getElementById('calendar');
      calendarElement.innerHTML = '';
      const availableDates = [7, 8, 10, 11, 18, 24];
      let dayCounter = 2;

      for (let i = 0; i < 28; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.classList.add('calendar-day');
        dayDiv.innerText = dayCounter;

        if (!availableDates.includes(dayCounter)) {
          dayDiv.classList.add('disabled');
        } else {
          dayDiv.onclick = function() {
            selectDate(dayCounter, dayDiv);
          };
        }

        calendarElement.appendChild(dayDiv);
        dayCounter++;
      }
      console.log("âœ… ìº˜ë¦°ë” ìƒì„± ì™„ë£Œ");
    }

    // ë‚ ì§œ ì„ íƒ í•¨ìˆ˜
    function selectDate(day, element) {
      document.querySelectorAll('.calendar-day').forEach(div => div.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('selectedDate').value = day;
    }

    // í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ

    // í˜ì´ì§€ 1 â†’ í˜ì´ì§€ 2
    document.getElementById("next1").addEventListener("click", function() {
      nextPage("page1", "page2");
    });

    // í˜ì´ì§€ 2 â†’ í˜ì´ì§€ 3
    document.getElementById("next2").addEventListener("click", function() {
      nextPage("page2", "page3");
    });

    // í˜ì´ì§€ 3: "ì˜ˆ" ë˜ëŠ” "ì•„ë‹ˆì˜¤" ë²„íŠ¼ í´ë¦­ ì‹œ (ì´ ë¶€ë¶„ì€ ì €ì¥í•˜ì§€ ì•ŠìŒ)
    document.getElementById("yes").addEventListener("click", function() {
      console.log("ğŸ”¹ í˜ì´ì§€3 ì‘ë‹µ: ì˜ˆ");
      nextPage("page3", "page4");
    });
    document.getElementById("no").addEventListener("click", function() {
      console.log("ğŸ”¹ í˜ì´ì§€3 ì‘ë‹µ: ì•„ë‹ˆì˜¤");
      nextPage("page3", "page4");
    });

    // í˜ì´ì§€ 4 â†’ í˜ì´ì§€ 5 (ì—¬ê¸°ì„œëŠ” ë³„ë„ì˜ ì‘ë‹µ ì €ì¥ ì—†ì´ ë‹¨ìˆœ í˜ì´ì§€ ì´ë™)
    document.getElementById("agree").addEventListener("click", function() {
      console.log("âœ… 'ì‘' ë²„íŠ¼ ëˆŒë¦¼ â†’ page5ë¡œ ì´ë™");
      nextPage("page4", "page5");
    });
    document.getElementById("disagree").addEventListener("click", function() {
      console.log("âœ… 'ì•„ë‹ˆ' ë²„íŠ¼ ëˆŒë¦¼ â†’ page5ë¡œ ì´ë™");
      nextPage("page4", "page5");
    });

    // í˜ì´ì§€ 5: ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œ ì„ íƒ í›„ "ì œì¶œ" ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById("submitDate").addEventListener("click", function() {
      const selectedDate = document.getElementById('selectedDate').value;
      if (!selectedDate) {
        alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
        return;
      }
      selectedDateResponse = selectedDate;
      console.log("ğŸ”¹ í˜ì´ì§€5 ì‘ë‹µ (ì„ íƒ ë‚ ì§œ):", selectedDateResponse);
      // ì´ë¦„ê³¼ ë‚ ì§œë§Œ ì „ì†¡
      sendCombinedResponse();
    });

  });
</script>
